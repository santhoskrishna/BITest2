//HintName: RouteHandlerValidations.g.cs
// <auto-generated/>
#nullable enable
namespace System.Runtime.CompilerServices
{
    [AttributeUsage(System.AttributeTargets.Method, AllowMultiple = true)]
    file sealed class InterceptsLocationAttribute : Attribute
    {
        public InterceptsLocationAttribute(int version, string data) { }
    }
}

namespace Microsoft.AspNetCore.Http.Validations.Generated
{
    using System;
    using System.Linq;
    using System.Diagnostics;
    using System.ComponentModel.DataAnnotations;
    
    file class EndpointKey(string route, global::System.Collections.Generic.IEnumerable<string> methods)
    {
        public string Route { get; } = route;
        public global::System.Collections.Generic.IEnumerable<string> Methods { get; } = methods;
        
        public override bool Equals(object? obj)
        {
            if (obj is EndpointKey other)
            {
                return string.Equals(Route, other.Route, global::System.StringComparison.OrdinalIgnoreCase) &&
                Methods.SequenceEqual(other.Methods, global::System.StringComparer.OrdinalIgnoreCase);
            }
            return false;
        }
        
        public override int GetHashCode()
        {
            int hash = 17;
            hash = hash * 23 + (Route?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0);
            hash = hash * 23 + GetMethodsHashCode(Methods);
            return hash;
        }
        
        private static int GetMethodsHashCode(global::System.Collections.Generic.IEnumerable<string> methods)
        {
            if (methods == null)
            {
                return 0;
            }
            int hash = 17;
            foreach (var method in methods)
            {
                hash = hash * 23 + (method?.GetHashCode(global::System.StringComparison.OrdinalIgnoreCase) ?? 0);
            }
            return hash;
        }
    }

    file class ValidationProblemBuilder
    {
        private readonly global::Microsoft.AspNetCore.Http.HttpValidationProblemDetails _problemDetails;
        
        public ValidationProblemBuilder()
        {
            _problemDetails = new global::Microsoft.AspNetCore.Http.HttpValidationProblemDetails();
        }
        
        public ValidationProblemBuilder WithTitle(string title)
        {
            _problemDetails.Title = title;
            return this;
        }
        
        public ValidationProblemBuilder WithStatus(int? status)
        {
            _problemDetails.Status = status;
            return this;
        }
        
        public ValidationProblemBuilder WithDetail(string detail)
        {
            _problemDetails.Detail = detail;
            return this;
        }
        
        public ValidationProblemBuilder WithInstance(string instance)
        {
            _problemDetails.Instance = instance;
            return this;
        }
        
        public ValidationProblemBuilder WithType(string type)
        {
            _problemDetails.Type = type;
            return this;
        }
        
        public ValidationProblemBuilder WithExtensions(global::System.Collections.Generic.IDictionary<string, object> extensions)
        {
            foreach (var kvp in extensions)
            {
                _problemDetails.Extensions[kvp.Key] = kvp.Value;
            }
            return this;
        }
        
        public ValidationProblemBuilder WithErrors(global::System.Collections.Generic.IDictionary<string, string[]> errors)
        {
            foreach (var kvp in errors)
            {
                _problemDetails.Errors[kvp.Key] = kvp.Value;
            }
            return this;
        }
        
        public ValidationProblemBuilder WithError(string key, string error)
        {
            if (_problemDetails.Errors.ContainsKey(key))
            {
                _problemDetails.Errors[key] = _problemDetails.Errors[key].Append(error).ToArray();
            }
            else
            {
                _problemDetails.Errors[key] = new string[] { error };
            }
            return this;
        }
        
        public ValidationProblemBuilder WithErrors(string key, string[] errors)
        {
            if (_problemDetails.Errors.ContainsKey(key))
            {
                _problemDetails.Errors[key] = _problemDetails.Errors[key].Concat(errors).ToArray();
            }
            else
            {
                _problemDetails.Errors[key] = errors;
            }
            return this;
        }
        
        public global::Microsoft.AspNetCore.Http.HttpValidationProblemDetails Build()
        {
            return _problemDetails;
        }
        
        public bool HasValue()
        {
            return _problemDetails.Errors.Count > 0;
        }
    }

    file static class WithValidationsInterceptor
    {
        [global::System.Runtime.CompilerServices.InterceptsLocationAttribute(1, "e96px15Ji9NhefBjLD9dcd8AAABQcm9ncmFtLmNz")]
        public static global::Microsoft.AspNetCore.Builder.IEndpointConventionBuilder WithValidation(this global::Microsoft.AspNetCore.Builder.IEndpointConventionBuilder builder)
        {
            System.Diagnostics.Debugger.Break();
            builder.AddEndpointFilter(async (context, next) =>
            {
                var targetEndpoint = context.HttpContext.Features.Get<global::Microsoft.AspNetCore.Http.Features.IEndpointFeature>()?.Endpoint;
                Debug.Assert(targetEndpoint != null);
                var route = ((global::Microsoft.AspNetCore.Routing.RouteEndpoint)targetEndpoint).RoutePattern.RawText;
                var methods = ((global::Microsoft.AspNetCore.Routing.RouteEndpoint)targetEndpoint).Metadata.GetMetadata<global::Microsoft.AspNetCore.Routing.IHttpMethodMetadata>()?.HttpMethods ?? ["GET"];
                Debug.Assert(route != null);
                var validationFilter = ValidationsFilters.Filters[new EndpointKey(route, methods)];
                var validationProblemDetails = validationFilter(context);
                if (validationProblemDetails == null)
                {
                    return await next(context);
                }
                return global::Microsoft.AspNetCore.Http.TypedResults.ValidationProblem(validationProblemDetails.Errors);
            });
            return builder;
        }
    }


    file static class ValidationTypes
    {
        public static global::Microsoft.AspNetCore.Http.HttpValidationProblemDetails? Validate<T>(T value, global::System.ComponentModel.DataAnnotations.ValidationContext? validationContext = null, IServiceProvider? serviceProvider = null, int currentDepth = 0, bool skipRecurse = false) => null;
        
        private static readonly ValidationAttribute Int32IdRangeAttribute = new global::System.ComponentModel.DataAnnotations.RangeAttribute(1, 10);
        
        public static global::Microsoft.AspNetCore.Http.HttpValidationProblemDetails? Validate(Todo? value, global::System.ComponentModel.DataAnnotations.ValidationContext? validationContext = null, IServiceProvider? serviceProvider = null, int currentDepth = 0, bool skipRecurse = false)
        {
            var maxDepth = ((global::Microsoft.Extensions.Options.IOptions<global::Microsoft.AspNetCore.Http.Json.JsonOptions>)(serviceProvider ?? validationContext).GetService(typeof(global::Microsoft.Extensions.Options.IOptions<global::Microsoft.AspNetCore.Http.Json.JsonOptions>))).Value?.SerializerOptions.MaxDepth;
            if (currentDepth > (maxDepth == null || maxDepth == 0 ? 64 : maxDepth))
            {
                return null;
            }
            ValidationProblemBuilder resultBuilder = new();
            if (value != null)
            {
                validationContext ??= new(value, serviceProvider: serviceProvider, items: null);
                validationContext.DisplayName = "Id";
                validationContext.MemberName = "Id";
                global::System.ComponentModel.DataAnnotations.ValidationResult? validationResult;
                validationResult = Int32IdRangeAttribute.GetValidationResult(value?.Id, validationContext);
                if (validationResult is global::System.ComponentModel.DataAnnotations.ValidationResult { ErrorMessage: not null })
                {
                    resultBuilder.WithError("Id", validationResult.ErrorMessage);
                }
            }
            return resultBuilder.HasValue() ? resultBuilder.Build() : null;
        }
    }


    file static class ValidationsFilters
    {
        public static readonly global::System.Collections.Generic.Dictionary<EndpointKey, global::System.Func<global::Microsoft.AspNetCore.Http.EndpointFilterInvocationContext, global::Microsoft.AspNetCore.Http.HttpValidationProblemDetails?>> Filters = new()
        {
            { new EndpointKey("/todos/{id}", ["GET"]), context => 
                {
                    ValidationProblemBuilder resultBuilder = new();
                    global::System.ComponentModel.DataAnnotations.ValidationResult? validationResult = null;
                    var value0 = context.GetArgument<int>(0);
                    var idRangeAttribute = new global::System.ComponentModel.DataAnnotations.RangeAttribute(1, 10);
                    validationResult = idRangeAttribute.GetValidationResult(value0, new global::System.ComponentModel.DataAnnotations.ValidationContext(value0) { DisplayName = "id" });
                    if (validationResult is not null)
                    {
                        resultBuilder.WithError("id", validationResult.ErrorMessage);
                    }
                    return resultBuilder.HasValue() ? resultBuilder.Build() : null;
                }
            },

            { new EndpointKey("/todos", ["POST"]), context => 
                {
                    ValidationProblemBuilder resultBuilder = new();
                    var value0 = context.GetArgument<Todo>(0);
                    var typeValidationResult = ValidationTypes.Validate(value0, serviceProvider: context.HttpContext.RequestServices);
                    if (typeValidationResult is not null)
                    {
                        foreach (var error in typeValidationResult.Errors)
                        {
                            resultBuilder.WithErrors(error.Key, error.Value);
                        }
                    }
                    return resultBuilder.HasValue() ? resultBuilder.Build() : null;
                }
            },

            { new EndpointKey("/todos", ["PUT"]), context => 
                {
                    ValidationProblemBuilder resultBuilder = new();
                    var value0 = context.GetArgument<Todo>(0);
                    var typeValidationResult = ValidationTypes.Validate(value0, serviceProvider: context.HttpContext.RequestServices);
                    if (typeValidationResult is not null)
                    {
                        foreach (var error in typeValidationResult.Errors)
                        {
                            resultBuilder.WithErrors(error.Key, error.Value);
                        }
                    }
                    return resultBuilder.HasValue() ? resultBuilder.Build() : null;
                }
            },

            { new EndpointKey("/todos/{id}", ["delete", "PaTcH"]), context => 
                {
                    ValidationProblemBuilder resultBuilder = new();
                    global::System.ComponentModel.DataAnnotations.ValidationResult? validationResult = null;
                    var value0 = context.GetArgument<int>(0);
                    var idRangeAttribute = new global::System.ComponentModel.DataAnnotations.RangeAttribute(1, 10);
                    validationResult = idRangeAttribute.GetValidationResult(value0, new global::System.ComponentModel.DataAnnotations.ValidationContext(value0) { DisplayName = "id" });
                    if (validationResult is not null)
                    {
                        resultBuilder.WithError("id", validationResult.ErrorMessage);
                    }
                    return resultBuilder.HasValue() ? resultBuilder.Build() : null;
                }
            },

        };
    }
}
#nullable restore
